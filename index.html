<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkyReach VA — Professional Single File App</title>
  <meta name="description" content="SkyReach Virtual Airline — polished single-file web app for flight planning, fleet and pilot management, and AI assistant." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#071427; --panel:#0d2b44; --muted:#9fb4c8; --accent:#63b3ff; --gold:#e0b45c; --glass:rgba(255,255,255,0.03); --card:#071c2b;
      --radius:14px; --shadow: 0 8px 30px rgba(2,6,23,0.55);
    }
    [data-theme="light"]{ --bg:#f4f7fb; --panel:#fff; --muted:#42515e; --accent:#0b66ff; --gold:#c79a4b; --card:#f6fbff }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--muted);background:linear-gradient(180deg,var(--bg),#042036);-webkit-font-smoothing:antialiased}

    .wrap{max-width:1260px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:18px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--gold));display:flex;align-items:center;justify-content:center;font-weight:800;color:#021;box-shadow:0 6px 18px rgba(2,8,12,0.6)}
    h1{margin:0;color:#fff;font-size:22px}
    .subtitle{font-size:13px;color:rgba(255,255,255,0.6)}

    nav{margin-left:auto;display:flex;gap:8px}
    .navbtn{background:transparent;border:none;color:rgba(255,255,255,0.65);padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:600;transition:all .18s}
    .navbtn:hover{transform:translateY(-2px)}
    .navbtn.active{background:rgba(255,255,255,0.04);color:var(--accent);box-shadow:inset 0 -2px 0 rgba(255,255,255,0.02)}

    main{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:22px}
    .panel{background:var(--panel);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .panel h2{margin:0 0 10px 0;color:white}
    .muted{font-size:13px;color:var(--muted)}

    /* Dashboard grid */
    .overview{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px}
    .card .big{font-size:22px;color:var(--accent);font-weight:800}
    .card .small{font-size:12px;color:var(--muted)}

    /* Planner / Forms */
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input,select,textarea,button{font-family:inherit}
    .input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .btn{background:linear-gradient(90deg,var(--accent),var(--gold));border:none;color:#021;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:800}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}

    /* Lists */
    .list{display:flex;flex-direction:column;gap:10px}
    .list-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
    .meta{display:flex;flex-direction:column}
    .meta .title{font-weight:700;color:#fff}
    .actions{display:flex;gap:8px}

    /* Fleet */
    .aircraft{display:flex;gap:12px;align-items:center}
    .plane{width:74px;height:54px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;font-weight:700}

    /* Assistant */
    #assistant{display:flex;flex-direction:column;height:360px}
    #chat{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:10px}
    .bubble{padding:10px;border-radius:12px;background:rgba(255,255,255,0.03);max-width:78%;line-height:1.4}
    .bubble.user{align-self:flex-end;background:linear-gradient(90deg,var(--accent),var(--gold));color:#021}
    #msgbox{display:flex;gap:8px;margin-top:12px}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center}
    .modal{width:720px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.7)}

    footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:980px){main{grid-template-columns:1fr}nav{display:none}.logo{width:52px;height:52px}}
  </style>
</head>
<body data-theme="dark">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SRH</div>
        <div>
          <h1>SkyReach Virtual Airline</h1>
          <div class="subtitle">Professional single-file app — flight planning, fleet & pilots</div>
        </div>
      </div>

      <nav id="nav">
        <button class="navbtn active" data-target="dashboard">Dashboard</button>
        <button class="navbtn" data-target="planner">Flight Planner</button>
        <button class="navbtn" data-target="flights">My Flights</button>
        <button class="navbtn" data-target="fleet">Fleet</button>
        <button class="navbtn" data-target="assistant">AI Assistant</button>
        <button class="navbtn" id="themeToggle">Toggle Theme</button>
      </nav>
    </header>

    <main>
      <section id="content" class="panel" aria-live="polite"></section>

      <aside class="panel" aria-label="sidebar">
        <h2>Quick Actions</h2>
        <div style="display:flex;flex-direction:column;gap:12px;margin-top:12px">
          <button class="btn" id="quickNew">New Flight</button>
          <button class="btn ghost" id="exportAll">Export Flights</button>
          <button class="btn ghost" id="invSave">Download Data</button>
          <button class="btn ghost" id="resetData">Reset Local Data</button>
        </div>

        <div style="margin-top:20px">
          <h2>Overview</h2>
          <div class="overview" style="margin-top:12px">
            <div class="card"><div class="big" id="statFlights">0</div><div class="small">Total Flights</div></div>
            <div class="card"><div class="big" id="statPilots">0</div><div class="small">Pilots</div></div>
            <div class="card"><div class="big" id="statFleet">0</div><div class="small">Fleet size</div></div>
          </div>

          <div style="margin-top:12px;font-size:13px;color:var(--muted)">Total Hours: <strong id="statHours">0</strong></div>
        </div>
      </aside>
    </main>

    <footer>SkyReach • Built for VA ops • Host anywhere • Exportable flight plans</footer>
  </div>

  <!-- Modal container -->
  <div id="modalRoot"></div>

  <script>
    // --- Storage and state ---
    const KEY = 'skyreach_app_v2';
    const defaults = {fleet:[],pilots:[],flights:[]};
    let state = loadState();

    // --- Initialize with tasteful sample data if empty ---
    function seedIfEmpty(){
      if(state.fleet.length===0){ state.fleet.push({id:uid(),name:'Airbus A320neo',icao:'A320',range_nm:3300,cruise_kts:450,capacity:180}); state.fleet.push({id:uid(),name:'Embraer E190',icao:'E190',range_nm:2400,cruise_kts:420,capacity:100}); }
      if(state.pilots.length===0){ state.pilots.push({id:uid(),name:'Captain Luca',hours:420,rank:'Senior'}); }
      if(state.flights.length===0){ state.flights.push({id:uid(),dep:'EGCC',arr:'EGKK',aircraftId:state.fleet[0].id,block_mins:75,pilotId:state.pilots[0].id,status:'Scheduled',date:new Date().toISOString()}); }
      save();
    }
    seedIfEmpty();

    function loadState(){ try{const raw=localStorage.getItem(KEY);return raw?JSON.parse(raw):JSON.parse(JSON.stringify(defaults));}catch(e){console.error(e);return JSON.parse(JSON.stringify(defaults));}}
    function save(){localStorage.setItem(KEY,JSON.stringify(state));renderStats();}
    function uid(){return 'id_'+Math.random().toString(36).slice(2,9)}

    // --- Utility DOM helper ---
    function $el(tag,props={},...children){const e=document.createElement(tag);for(const k in props){if(k.startsWith('on')) e.addEventListener(k.slice(2),props[k]); else if(k==='html') e.innerHTML=props[k]; else e.setAttribute(k,props[k]);} children.flat().forEach(c=>{if(typeof c==='string'||typeof c==='number') e.appendChild(document.createTextNode(c)); else if(c) e.appendChild(c)}); return e}

    // --- Router ---
    const content = document.getElementById('content');
    document.getElementById('nav').addEventListener('click', (e)=>{ const b=e.target.closest('.navbtn'); if(!b) return; document.querySelectorAll('.navbtn').forEach(n=>n.classList.remove('active')); b.classList.add('active'); renderSection(b.dataset.target); });
    document.getElementById('themeToggle').addEventListener('click', ()=>{ document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark'; });

    function renderSection(name='dashboard'){ content.innerHTML=''; if(name==='dashboard') renderDashboard(); if(name==='planner') renderPlanner(); if(name==='flights') renderFlights(); if(name==='fleet') renderFleet(); if(name==='assistant') renderAssistant(); }

    // --- Dashboard ---
    function renderDashboard(){
      const recent = state.flights.slice(-6).reverse();
      const container = $el('div',{}, $el('h2',{},'Dashboard'), $el('div',{class:'muted'},'Overview of SkyReach operations'),
        $el('div',{style:'margin-top:14px;'}, $el('div',{class:'overview'},
          $card('Total Flights',state.flights.length,'statFlights'), $card('Pilots',state.pilots.length,'statPilots'), $card('Fleet',state.fleet.length,'statFleet')
        )),
        $el('div',{style:'margin-top:18px'}, $el('h2',{},'Recent Flights')), $el('div',{class:'list',style:'margin-top:12px'}, ...recent.map(f=> flightRow(f)))
      );
      content.appendChild(container);
    }
    function $card(title,value,id){ return $el('div',{class:'card'}, $el('div',{class:'big',id:id},value), $el('div',{class:'small'},title)); }

    function flightRow(f){ const craft = state.fleet.find(x=>x.id===f.aircraftId) || {name:'N/A'}; const pilot = state.pilots.find(x=>x.id===f.pilotId) || {name:'Unassigned'}; const node = $el('div',{class:'list-item'}, $el('div',{class:'meta'}, $el('div',{class:'title'},`✈️ ${f.dep} → ${f.arr}`), $el('div',{class:'muted'},`${craft.name} • ${pilot.name} • ${f.block_mins} mins • ${new Date(f.date).toLocaleString()}`)), $el('div',{class:'actions'}, $el('button',{class:'btn ghost',onClick:()=>openFlightModal(f.id)},'View'), $el('button',{class:'btn ghost',onClick:()=>simulateFlight(f.id)},'Simulate'))); return node; }

    // --- Planner ---
    function renderPlanner(){ const selArt = state.fleet.map(a=>$el('option',{value:a.id},`${a.name} (${a.icao})`)); const selPilot = [ $el('option',{value:''},'Unassigned'), ...state.pilots.map(p=>$el('option',{value:p.id},p.name))];
      const container = $el('div',{}, $el('h2',{},'Flight Planner'), $el('div',{class:'muted'},'Create flights quickly with accurate defaults'),
        $el('div',{style:'margin-top:12px;display:grid;gap:10px'},
          $label('Departure (ICAO)', $el('input',{class:'input',id:'dep',placeholder:'EGLL'})),
          $label('Destination (ICAO)', $el('input',{class:'input',id:'arr',placeholder:'EGKK'})),
          $el('div',{class:'row'}, $el('div',{}, $label('Aircraft', $el('select',{class:'input',id:'aircraft'}, ...selArt))), $el('div',{}, $label('Pilot', $el('select',{class:'input',id:'pilot'}, ...selPilot)))) ,
          $el('div',{class:'row'}, $el('input',{class:'input',id:'block',placeholder:'Block time (mins)',type:'number'}), $el('input',{class:'input',id:'date',type:'datetime-local'})),
          $el('div',{style:'display:flex;gap:10px'}, $el('button',{class:'btn',onClick:createFlight},'Create Flight'), $el('button',{class:'btn ghost',onClick:()=>{document.getElementById('dep').value='';document.getElementById('arr').value='';}} ,'Clear'))
        )
      );
      content.appendChild(container);
    }
    function $label(txt,field){ return $el('label',{}, $el('div',{},txt), field); }

    function createFlight(){ const dep=document.getElementById('dep').value.trim().toUpperCase(); const arr=document.getElementById('arr').value.trim().toUpperCase(); const aircraftId=document.getElementById('aircraft')?.value || null; const pilotId=document.getElementById('pilot')?.value || null; const block=parseInt(document.getElementById('block')?.value)||60; const date=document.getElementById('date')?.value || new Date().toISOString(); if(!/^[A-Z]{3,4}$/.test(dep)||!/^[A-Z]{3,4}$/.test(arr)){ return showToast('Enter valid ICAO codes for departure and destination','error'); } const f={id:uid(),dep,arr,aircraftId,pilotId,block_mins:block,date,status:'Scheduled'}; state.flights.push(f); save(); renderSection('flights'); showToast('Flight created','success'); }

    // --- Flights page ---
    function renderFlights(){ const container = $el('div',{}, $el('h2',{},'My Flights'), $el('div',{class:'muted'},'Manage your scheduled and completed flights'), $el('div',{style:'margin-top:12px'}, ...state.flights.map(f=> $el('div',{class:'list-item'}, $el('div',{class:'meta'}, $el('div',{class:'title'},`✈️ ${f.dep} → ${f.arr}`), $el('div',{class:'muted'},`Date: ${new Date(f.date).toLocaleString()} • ${f.block_mins} mins • Status: ${f.status}`)), $el('div',{class:'actions'}, $el('button',{class:'btn',onClick:()=>downloadFPL(f.id)},'Export FPL'), $el('button',{class:'btn ghost',onClick:()=>openFlightModal(f.id)},'Open'), $el('button',{class:'btn ghost',onClick:()=>simulateFlight(f.id)},'Simulate')))))); content.appendChild(container); }

    function downloadFPL(id){ const f=state.flights.find(x=>x.id===id); if(!f) return showToast('Flight not found','error'); const craft=state.fleet.find(a=>a.id===f.aircraftId)||{name:'Unknown'}; const pilot=state.pilots.find(p=>p.id===f.pilotId)||{name:'Unassigned'}; const text = `SkyReach Virtual Airline\nFlight ID: ${f.id}\nPilot: ${pilot.name}\nAircraft: ${craft.name}\nDeparture: ${f.dep}\nArrival: ${f.arr}\nBlock Time: ${f.block_mins} mins\nScheduled: ${new Date(f.date).toISOString()}\n\nGenerated by SkyReach` ; const blob=new Blob([text],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`fpl_${f.dep}_${f.arr}.txt`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); showToast('FPL exported','success'); }

    function simulateFlight(id){ const f=state.flights.find(x=>x.id===id); if(!f) return; f.status='Completed'; if(f.pilotId){ const p=state.pilots.find(x=>x.id===f.pilotId); if(p) p.hours = Math.round((p.hours + f.block_mins/60)*10)/10; } save(); renderSection('flights'); showToast('Flight simulated and completed','success'); }

    // --- Fleet ---
    function renderFleet(){ const container = $el('div',{}, $el('h2',{},'Fleet Management'), $el('div',{class:'muted'},'Manage aircraft data and performance'), $el('div',{style:'margin-top:12px;display:flex;gap:10px'}, $el('button',{class:'btn',onClick:openAddAircraft},'Add Aircraft'), $el('button',{class:'btn ghost',onClick:()=>downloadJSON(state.fleet,'fleet')},'Export Fleet')) , $el('div',{style:'margin-top:12px'}, ...state.fleet.map(a=> $el('div',{class:'list-item'}, $el('div',{class:'aircraft'}, $el('div',{class:'plane'},a.icao), $el('div',{}, $el('div',{class:'title'},a.name), $el('div',{class:'muted'},`${a.range_nm} nm • ${a.cruise_kts} kts • ${a.capacity} pax`)))), $el('div',{class:'actions'}, $el('button',{class:'btn ghost',onClick:()=>openEditAircraft(a.id)},'Edit'), $el('button',{class:'btn ghost',onClick:()=>removeAircraft(a.id)},'Remove')))))); content.appendChild(container); }

    function openAddAircraft(){ openModal($el('div',{}, $el('h3',{},'Add Aircraft'), $el('div',{style:'display:grid;gap:8px;margin-top:8px'}, $label('Name', $el('input',{id:'ac_name',class:'input'})), $label('ICAO', $el('input',{id:'ac_icao',class:'input'})), $label('Range (nm)', $el('input',{id:'ac_range',class:'input',type:'number'})), $label('Cruise (kts)', $el('input',{id:'ac_cruise',class:'input',type:'number'})), $label('Capacity', $el('input',{id:'ac_pax',class:'input',type:'number'}))), $el('div',{style:'display:flex;gap:8px;margin-top:12px;justify-content:flex-end'}, $el('button',{class:'btn',onClick:()=>{ const name=document.getElementById('ac_name').value.trim(); const icao=document.getElementById('ac_icao').value.trim().toUpperCase(); const range=parseInt(document.getElementById('ac_range').value)||0; const cruise=parseInt(document.getElementById('ac_cruise').value)||0; const pax=parseInt(document.getElementById('ac_pax').value)||0; if(!name||!icao) return showToast('Name and ICAO required','error'); state.fleet.push({id:uid(),name,icao,range_nm:range,cruise_kts:cruise,capacity:pax}); save(); closeModal(); renderSection('fleet'); showToast('Aircraft added','success'); }},'Save'), $el('button',{class:'btn ghost',onClick:closeModal},'Cancel')) )); }

    function openEditAircraft(id){ const a = state.fleet.find(x=>x.id===id); if(!a) return; openModal($el('div',{}, $el('h3',{},'Edit Aircraft'), $el('div',{style:'display:grid;gap:8px;margin-top:8px'}, $label('Name', $el('input',{id:'ac_name',class:'input',value:a.name})), $label('ICAO', $el('input',{id:'ac_icao',class:'input',value:a.icao})), $label('Range (nm)', $el('input',{id:'ac_range',class:'input',type:'number',value:a.range_nm})), $label('Cruise (kts)', $el('input',{id:'ac_cruise',class:'input',type:'number',value:a.cruise_kts})), $label('Capacity', $el('input',{id:'ac_pax',class:'input',type:'number',value:a.capacity}))), $el('div',{style:'display:flex;gap:8px;margin-top:12px;justify-content:flex-end'}, $el('button',{class:'btn',onClick:()=>{ a.name=document.getElementById('ac_name').value.trim(); a.icao=document.getElementById('ac_icao').value.trim().toUpperCase(); a.range_nm=parseInt(document.getElementById('ac_range').value)||0; a.cruise_kts=parseInt(document.getElementById('ac_cruise').value)||0; a.capacity=parseInt(document.getElementById('ac_pax').value)||0; save(); closeModal(); renderSection('fleet'); showToast('Aircraft updated','success'); }},'Save'), $el('button',{class:'btn ghost',onClick:closeModal},'Cancel')) )); }

    function removeAircraft(id){ if(!confirm('Remove aircraft?')) return; state.fleet = state.fleet.filter(x=>x.id!==id); save(); renderSection('fleet'); showToast('Aircraft removed','success'); }

    // --- Assistant ---
    function renderAssistant(){ const container = $el('div',{}, $el('h2',{},'AI Flight Assistant'), $el('div',{class:'muted'},'A smart, rule-based assistant to guide pilots'), $el('div',{id:'assistant',style:'margin-top:12px'}, $el('div',{id:'chat'}), $el('div',{id:'msgbox'}, $el('input',{id:'msg',class:'input',placeholder:'Ask about planning, FPL export, or VA rules'}), $el('button',{class:'btn',onClick:sendMsg},'Send')))); content.appendChild(container); renderAssistantWelcome(); }

    function renderAssistantWelcome(){ const chat=document.getElementById('chat'); chat.innerHTML=''; chat.appendChild($el('div',{class:'bubble'},'SkyReach Assistant online — ask to \"Plan from EGCC to EGKK\" or \"Export FPL for [flight id]\".')) }
    function sendMsg(){ const msg=document.getElementById('msg'); const txt=msg.value.trim(); if(!txt) return; appendBubble(txt,true); msg.value=''; setTimeout(()=>{ const reply=assistantReply(txt); appendBubble(reply,false); },400); }
    function appendBubble(txt,isUser){ const chat=document.getElementById('chat'); const b=$el('div',{class:'bubble'+(isUser?' user':'' )},txt); chat.appendChild(b); chat.scrollTop = chat.scrollHeight; }
    function assistantReply(msgRaw){ const msg=msgRaw.toLowerCase(); if(msg.includes('plan') && msg.includes('from')){ const parts=msg.match(/from\s+([a-z]{3,4})\s+to\s+([a-z]{3,4})/i); if(parts){ const dep=parts[1].toUpperCase(), arr=parts[2].toUpperCase(); return `Suggested plan: ${dep} → ${arr}. Open Flight Planner, enter ${dep} as departure and ${arr} as destination, choose aircraft and pilot, then Create Flight.` } return 'Tell me: Plan from [ICAO] to [ICAO].'; } if(msg.includes('export')||msg.includes('fpl')){ return 'To export: open My Flights, pick the flight and click Export FPL. You can also download the fleet/pilot JSON.' } if(msg.includes('simulate')){ return 'Use the My Flights page and press Simulate on a flight to mark it completed and credit pilot hours.' } if(msg.includes('help')){ return 'I can help with: planning flights, exporting flight plans, managing fleet, and simulating flights. Try: \"Plan from EGLL to EGKK\"' } return 'Sorry, I did not understand — try: \"Plan from EGCC to EGKK\" or \"Export FPL\".' }

    // --- Modal utilities ---
    function openModal(node){ const root=document.getElementById('modalRoot'); root.innerHTML=''; const backdrop=$el('div',{class:'modal-backdrop'}); const modal=$el('div',{class:'modal'}, node); backdrop.appendChild(modal); root.appendChild(backdrop); backdrop.addEventListener('click',(e)=>{ if(e.target===backdrop) closeModal(); }); }
    function closeModal(){ document.getElementById('modalRoot').innerHTML=''; }

    // --- Flight modal ---
    function openFlightModal(id){ const f=state.flights.find(x=>x.id===id); if(!f) return; const craft=state.fleet.find(x=>x.id===f.aircraftId)||{}; const pilot=state.pilots.find(x=>x.id===f.pilotId)||{}; const node = $el('div',{}, $el('h3',{},`Flight ${f.dep} → ${f.arr}`), $el('div',{style:'display:grid;gap:8px;margin-top:8px'}, $el('div',{}, $el('strong',{},'Aircraft: '), craft.name||'Unassigned'), $el('div',{}, $el('strong',{},'Pilot: '), pilot.name||'Unassigned'), $el('div',{}, $el('strong',{},'Block Time: '), `${f.block_mins} mins`), $el('div',{}, $el('strong',{},'Status: '), f.status), $el('div',{}, $el('strong',{},'Scheduled: '), new Date(f.date).toLocaleString())), $el('div',{style:'display:flex;gap:8px;margin-top:12px;justify-content:flex-end'}, $el('button',{class:'btn',onClick:()=>{ downloadFPL(f.id); }},'Export FPL'), $el('button',{class:'btn ghost',onClick:()=>{ simulateFlight(f.id); closeModal(); }},'Simulate'), $el('button',{class:'btn ghost',onClick:closeModal},'Close')));\n      openModal(node);\n    }\n\n    // --- Import/Export ---\n    function downloadJSON(obj,name){ const blob=new Blob([JSON.stringify(obj,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`${name}.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); showToast('Download started','success'); }\n\n    // --- Pilot management (simple) ---\n    // For brevity: add a few helpers exposed via quick commands\n    document.getElementById('invSave').addEventListener('click', ()=>{ downloadJSON(state,'skyreach_data'); });\n\n    // Quick new flight trigger\n    document.getElementById('quickNew').addEventListener('click', ()=>{ document.querySelectorAll('.navbtn').forEach(n=>n.classList.remove('active')); document.querySelector('[data-target=\"planner\"]').classList.add('active'); renderSection('planner'); window.scrollTo({top:0,behavior:'smooth'}); });\n    document.getElementById('exportAll').addEventListener('click', ()=>{ const all = state.flights.map(f=>{ const craft = state.fleet.find(a=>a.id===f.aircraftId)||{}; const pilot = state.pilots.find(p=>p.id===f.pilotId)||{}; return `Flight ${f.dep}→${f.arr}\\nPilot:${pilot.name}\\nAircraft:${craft.name}\\nDate:${new Date(f.date).toISOString()}\\n---\\n`; }).join('\\n'); const blob=new Blob([all],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='skyreach_flights_export.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); showToast('All flights exported','success'); });\n\n    document.getElementById('resetData').addEventListener('click', ()=>{ if(!confirm('Reset all local SkyReach data?')) return; state = JSON.parse(JSON.stringify(defaults)); save(); seedIfEmpty(); renderSection('dashboard'); showToast('Data reset','success'); });\n\n    // --- tiny UI helpers: toast ---\n    function showToast(msg,type='info'){ const t = $el('div',{style:`position:fixed;right:20px;bottom:20px;padding:10px 14px;border-radius:10px;background:${ type==='error' ? 'linear-gradient(90deg,#ff7a7a,#ffb3b3)' : 'linear-gradient(90deg,var(--accent),var(--gold))'};color:#021;box-shadow:0 8px 24px rgba(2,6,23,0.5);z-index:9999`},msg); document.body.appendChild(t); setTimeout(()=>t.style.opacity='0.0',2200); setTimeout(()=>t.remove(),3200); }\n\n    // ensure initial render\n    renderStats(); renderSection('dashboard');\n\n    // expose small API for debug\n    window.SkyReach = {state,save,uid};\n  </script>\n</body>
</html>
